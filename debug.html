<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Modal Preview</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: #0f172a;
            color: #e2e8f0;
            padding: 40px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .debug-panel {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.5);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .debug-title {
            font-size: 18px;
            font-weight: 700;
            color: #fbbf24;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .column-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            margin-bottom: 6px;
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .column-item:hover {
            background: rgba(30, 41, 59, 0.5);
            border-color: rgba(168, 85, 247, 0.5);
        }
        
        .column-item.selected {
            background: rgba(168, 85, 247, 0.15);
            border-color: #a855f7;
            box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.1);
        }
        
        .preview-panel-bottom {
            border: 1px solid rgba(100, 116, 139, 0.3);
            background: rgba(15, 23, 42, 0.5);
            padding: 16px;
            min-height: 200px;
            border-radius: 12px;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            margin-bottom: 12px;
        }
        
        .preview-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: #a78bfa;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .preview-code {
            font-size: 12px;
            color: #cbd5e1;
            line-height: 1.8;
            padding: 16px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .btn {
            padding: 10px 20px;
            background: linear-gradient(to right, #a855f7, #3b82f6);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        #console-log {
            background: #000;
            color: #0f0;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="margin-bottom: 20px; color: #fbbf24;">üêõ Debug Modal Preview Test</h1>
        
        <!-- Test Data Display -->
        <div class="debug-panel">
            <div class="debug-title">
                <i class="fas fa-database"></i> Test Data Loaded
            </div>
            <div id="dataStatus"></div>
        </div>
        
        <!-- Selection Panel -->
        <div class="debug-panel">
            <div class="debug-title">
                <i class="fas fa-mouse-pointer"></i> Click to Select
            </div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                <div>
                    <h4 style="color: #94a3b8; margin-bottom: 8px; font-size: 12px;">IDENTITY</h4>
                    <div id="identityItems"></div>
                </div>
                <div>
                    <h4 style="color: #94a3b8; margin-bottom: 8px; font-size: 12px;">EXPERTISE</h4>
                    <div id="expertiseItems"></div>
                </div>
                <div>
                    <h4 style="color: #94a3b8; margin-bottom: 8px; font-size: 12px;">PERSONALITY</h4>
                    <div id="personalityItems"></div>
                </div>
            </div>
        </div>
        
        <!-- Current Selections -->
        <div class="debug-panel">
            <div class="debug-title">
                <i class="fas fa-check-circle"></i> Current Selections
            </div>
            <div id="currentSelections" style="font-family: monospace; font-size: 12px; color: #94a3b8;"></div>
        </div>
        
        <!-- Preview Panel -->
        <div class="debug-panel">
            <div class="debug-title">
                <i class="fas fa-eye"></i> Live Preview
            </div>
            <div class="preview-panel-bottom">
                <div class="preview-header">
                    <h3><i class="fas fa-code"></i> Combined Prompt</h3>
                    <button class="btn" onclick="copyToClipboard()">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                <div id="presetPreview" class="preview-content"></div>
            </div>
        </div>
        
        <!-- Console Log -->
        <div class="debug-panel">
            <div class="debug-title">
                <i class="fas fa-terminal"></i> Console Log
            </div>
            <div id="console-log"></div>
            <button class="btn" onclick="clearLog()" style="margin-top: 10px; background: rgba(239, 68, 68, 0.5);">
                Clear Log
            </button>
        </div>
    </div>

    <script>
        // Test Data
        const testPresets = [
            { id: 'id_analyst', name: 'Data Analyst', icon: 'üìä', description: 'Statistical expert', systemPrompt: 'You are a senior data analyst with expertise in statistics and visualization.', category: 'Identity' },
            { id: 'id_researcher', name: 'Researcher', icon: 'üî¨', description: 'Academic scientist', systemPrompt: 'You are a research scientist skilled in methodology and analysis.', category: 'Identity' },
            { id: 'exp_stats', name: 'Statistics', icon: 'üìà', description: 'Statistical analysis', systemPrompt: 'EXPERTISE: Statistical analysis, hypothesis testing, regression, ANOVA, time series.', category: 'Expertise' },
            { id: 'exp_finance', name: 'Finance', icon: 'üí∞', description: 'Financial analysis', systemPrompt: 'EXPERTISE: Financial modeling, valuation (DCF, comparables), risk assessment.', category: 'Expertise' },
            { id: 'pers_formal', name: 'Professional', icon: 'üé©', description: 'Formal business tone', systemPrompt: 'PERSONALITY: Communicate professionally with formal business language.', category: 'Personality' },
            { id: 'pers_friendly', name: 'Friendly', icon: 'üòä', description: 'Warm & approachable', systemPrompt: 'PERSONALITY: Be warm, friendly, and encouraging in communication.', category: 'Personality' }
        ];
        
        // Global selections
        let selectedIdentity = null;
        let selectedExpertise = null;
        let selectedPersonality = null;
        
        // Log function
        function log(message, type = 'info') {
            const logEl = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f87171' : type === 'success' ? '#4ade80' : '#0f0';
            logEl.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('console-log').innerHTML = '';
        }
        
        // Initialize
        function init() {
            log('üöÄ Initializing test...', 'info');
            
            // Display data status
            const dataStatus = document.getElementById('dataStatus');
            dataStatus.innerHTML = `
                <div style="color: #4ade80; font-weight: 600;">‚úÖ ${testPresets.length} presets loaded</div>
                <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">
                    Identity: ${testPresets.filter(p => p.category === 'Identity').length} |
                    Expertise: ${testPresets.filter(p => p.category === 'Expertise').length} |
                    Personality: ${testPresets.filter(p => p.category === 'Personality').length}
                </div>
            `;
            
            // Render items
            renderItems('Identity', 'identityItems', 'selectIdentity');
            renderItems('Expertise', 'expertiseItems', 'selectExpertise');
            renderItems('Personality', 'personalityItems', 'selectPersonality');
            
            // Initial preview
            updatePreview();
            
            log('‚úÖ Initialization complete', 'success');
        }
        
        function renderItems(category, containerId, selectFunc) {
            const container = document.getElementById(containerId);
            const items = testPresets.filter(p => p.category === category);
            
            container.innerHTML = items.map(item => `
                <div class="column-item" onclick="${selectFunc}('${item.id}')">
                    <span style="font-size: 20px;">${item.icon}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 12px; color: #f1f5f9;">${item.name}</div>
                        <div style="font-size: 10px; color: #94a3b8;">${item.description}</div>
                    </div>
                </div>
            `).join('');
            
            log(`Rendered ${items.length} items for ${category}`);
        }
        
        function selectIdentity(id) {
            selectedIdentity = testPresets.find(p => p.id === id);
            log(`Selected Identity: ${selectedIdentity.name}`, 'success');
            updateSelections();
            updatePreview();
        }
        
        function selectExpertise(id) {
            selectedExpertise = testPresets.find(p => p.id === id);
            log(`Selected Expertise: ${selectedExpertise.name}`, 'success');
            updateSelections();
            updatePreview();
        }
        
        function selectPersonality(id) {
            selectedPersonality = testPresets.find(p => p.id === id);
            log(`Selected Personality: ${selectedPersonality.name}`, 'success');
            updateSelections();
            updatePreview();
        }
        
        function updateSelections() {
            const div = document.getElementById('currentSelections');
            div.innerHTML = `
                <div>Identity: <span style="color: #fbbf24;">${selectedIdentity ? selectedIdentity.name : 'None'}</span></div>
                <div>Expertise: <span style="color: #fbbf24;">${selectedExpertise ? selectedExpertise.name : 'None'}</span></div>
                <div>Personality: <span style="color: #fbbf24;">${selectedPersonality ? selectedPersonality.name : 'None'}</span></div>
            `;
        }
        
        function updatePreview() {
            log('üîÑ Updating preview...', 'info');
            
            const preview = document.getElementById('presetPreview');
            if (!preview) {
                log('‚ùå ERROR: Preview element not found!', 'error');
                return;
            }
            
            const selections = [selectedIdentity, selectedExpertise, selectedPersonality];
            
            // Check if nothing is selected
            if (selections.every(s => !s)) {
                preview.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #64748b;">
                        <i class="fas fa-mouse-pointer" style="font-size: 32px; opacity: 0.5; margin-bottom: 12px; display: block;"></i>
                        <p style="font-size: 13px; margin: 0; font-weight: 600;">Click items above to build AI agent</p>
                    </div>
                `;
                log('Preview: Empty state (no selections)');
                return;
            }
            
            // Build combined prompt
            let sections = [];
            
            if (selectedIdentity) {
                sections.push({ title: 'üé≠ IDENTITY', content: selectedIdentity.systemPrompt });
            }
            if (selectedExpertise) {
                sections.push({ title: 'üß† EXPERTISE', content: selectedExpertise.systemPrompt });
            }
            if (selectedPersonality) {
                sections.push({ title: 'üí¨ PERSONALITY', content: selectedPersonality.systemPrompt });
            }
            
            const prompt = sections.map(s => `${s.title}\n${s.content}`).join('\n\n---\n\n');
            
            preview.innerHTML = `<div class="preview-code">${prompt.trim()}</div>`;
            
            log(`‚úÖ Preview updated with ${sections.length} sections`, 'success');
            log(`Preview length: ${prompt.length} characters`);
        }
        
        function copyToClipboard() {
            const preview = document.querySelector('.preview-code');
            if (preview) {
                navigator.clipboard.writeText(preview.textContent);
                log('üìã Copied to clipboard!', 'success');
                alert('Copied to clipboard!');
            }
        }
        
        // Run on load
        window.onload = init;
    </script>
</body>
</html>